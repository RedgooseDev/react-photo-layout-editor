!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("classnames"),require("jquery"),require("react-redux"),require("redux"),require("react-dom"),require("react-grid-layout"),require("react-simple-colorpicker")):"function"==typeof define&&define.amd?define(["react","classnames","jquery","react-redux","redux","react-dom","react-grid-layout","react-simple-colorpicker"],t):"object"==typeof exports?exports.PhotoLayoutEditor=t(require("react"),require("classnames"),require("jquery"),require("react-redux"),require("redux"),require("react-dom"),require("react-grid-layout"),require("react-simple-colorpicker")):e.PhotoLayoutEditor=t(e.React,e.classNames,e.$,e.PropTypes,e.PropTypes,e.ReactDOM,e.PropTypes,e.PropTypes)}(this,function(e,t,n,r,o,i,a,l){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=33)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.types=t.body=t.side=t.cropper=t.core=void 0;var o=n(30),i=r(o),a=n(29),l=r(a),u=n(31),c=r(u),s=n(32),f=r(s),d=n(2),p=r(d);t.core=i,t.cropper=c,t.side=f,t.body=l,t.types=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_PLE="INIT_PLE",t.SIDE_VISIBLE="SIDE_VISIBLE",t.SIDE_ADD_FILES="SIDE_ADD_FILES",t.SIDE_REMOVE_FILES="SIDE_REMOVE_FILES",t.SIDE_CHANGE_ACTIVE_FILE="SIDE_CHANGE_ACTIVE_FILE",t.SIDE_TOGGLE="SIDE_TOGGLE",t.SIDE_UPDATE_PROGRESS="SIDE_UPDATE_PROGRESS",t.ATTACH_IMAGES="ATTACH_IMAGES",t.ATTACH_IMAGE="ATTACH_IMAGE",t.GRID_ADD_BLOCK="GRID_ADD_BLOCK",t.GRID_REMOVE_BLOCK="GRID_REMOVE_BLOCK",t.GRID_SHUFFLE_BLOCKS="GRID_SHUFFLE_BLOCKS",t.GRID_DUPLICATE_BLOCK="GRID_DUPLICATE_BLOCK",t.GRID_UPDATE_BLOCKS="GRID_UPDATE_BLOCKS",t.GRID_ACTIVE_BLOCK="GRID_ACTIVE_BLOCK",t.GRID_SETTING_UPDATE="GRID_SETTING_UPDATE",t.GRID_CHANGE_COLOR="GRID_CHANGE_COLOR",t.GRID_REMOVE_IMAGES="GRID_REMOVE_IMAGES",t.CROPPER_OPEN="CROPPER_OPEN",t.CROPPER_CLOSE="CROPPER_CLOSE"},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.uploader=t.object=t.color=t.number=t.util=void 0;var o=n(38),i=r(o),a=n(36),l=r(a),u=n(9),c=r(u),s=n(35),f=r(s),d=n(37),p=function(e){return e&&e.__esModule?e:{default:e}}(d);t.util=i,t.number=l,t.color=f,t.object=c,t.uploader=p.default},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setting={base:{uploadScript:null,uploadParamsConvertFunc:null},body:{setting:{width:100,height:100,column:5,outerMargin:10,innerMargin:10,freeMode:!1},blockColor:"#ddd",grid:[{layout:{x:0,y:0,w:2,h:2}},{layout:{x:2,y:0,w:1,h:2}},{layout:{x:3,y:0,w:2,h:1}},{layout:{x:3,y:1,w:1,h:1}}]},side:{files:[],visible:!0,progressPercent:null}},t.side={files:[],visible:!0,progressPercent:null},t.body={visibleToolbarButtons:{setting:!0,shuffle:!0,add:!0,select:!0,edit:!1,removeImage:!1,duplicate:!1,removeBlock:!1,editColor:!1}}},function(e,t){e.exports=o},function(e,t,n){"use strict";function r(e){for(var t=e.length-1;t>=0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[n];e[n]=e[t],e[t]=r}return e}function o(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"index",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=0;r<e.length;r++)if(e[r][t]===n)return r}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!(!e||!e.length)}Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=r,t.findObjectValueInArray=o,t.isArray=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){this.layout=new a.default(e),this.side=new u.default(e),this.grid=new s.default(e),this.cropper=new d.default(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=n(15),a=r(i),l=n(16),u=r(l),c=n(14),s=r(c),f=n(13),d=r(f)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(6),p=n(4),h=r(p),m=n(1),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(m),b=n(21),y=r(b),g=n(28),_=r(g),E=n(23),O=r(E),w=(u=l=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.el=null,e}return a(t,e),c(t,[{key:"componentDidMount",value:function(){var e=this.props;e.dispatch(v.core.init(e.parent.api,e.parent.preference||{side:{},grid:{}},this.el))}},{key:"render",value:function(){var e=this,t=this.props;return f.default.createElement("div",{ref:function(t){e.el=t},className:(0,h.default)("ple-editor",{"side-active":t.tree.side.visible})},t.setting&&f.default.createElement("div",{className:"ple-wrap"},f.default.createElement(y.default,null),f.default.createElement(_.default,null),t.tree.cropper.visible?f.default.createElement(O.default,null):null))}}]),t}(f.default.Component),l.displayName="Container",l.defaultProps={parent:{},dispatch:null,tree:{},setting:null},u);t.default=(0,d.connect)(function(e){return Object.assign({},e,{})})(w)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),i=n(40),a=r(i),l=n(39),u=r(l),c=n(42),s=function(e){return e&&e.__esModule?e:{default:e}}(c),f=n(41),d=r(f);t.default=(0,o.combineReducers)({setting:a.setting,api:a.api,keyboard:a.keyboard,element:a.element,tree:(0,o.combineReducers)({side:s.default,body:(0,o.combineReducers)({setting:u.setting,visibleToolbarButtons:u.visibleToolbarButtons,grid:u.grid,activeBlock:u.activeBlock}),cropper:(0,o.combineReducers)({visible:d.visible,item:d.item})})})},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){this.open=function(t){var n=e.getState(),r=null;try{var o=u.object.findObjectValueInArray(n.tree.body.grid,"index",t);if("number"!=typeof o)throw"Not found item";if(r=n.tree.body.grid[o],!r.image)throw"Not found image in item"}catch(e){return void alert(e)}e.dispatch(a.cropper.open(r))},this.close=function(){console.log("close cropper"),e.dispatch(a.cropper.close())}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=n(1),a=r(i),l=n(3),u=r(l)},function(e,t,n){"use strict";function r(e){}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(1);!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(o)},function(e,t,n){"use strict";function r(e){this.toggleSide=function(t){try{var n=e.getState().tree.side.visible,r=void 0===t?!n:t;e.dispatch(i.side.visible(r))}catch(e){console.warn("Error action",e)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(1),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){this.uploading=!1,this.add=function(t){t instanceof Array&&e.dispatch(u.side.addFiles(t))},this.upload=function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.uploading){var o=a.default.Deferred(),i=e.getState();return this.uploading=!0,r.start&&r.start(),s.uploader(t,i.setting.base.uploadScript).progress(function(t,n){switch(t){case"start":e.dispatch(u.side.updateProgress(0));break;case"progress":var o=parseInt(n.loaded/n.total*100);e.dispatch(u.side.updateProgress(o));break;case"done":if(e.dispatch(u.side.updateProgress(null)),!n.data)return;if(i.setting.base.uploadParamsConvertFunc){var a=i.setting.base.uploadParamsConvertFunc(n.data);return void e.dispatch(u.side.addFiles([a]))}e.dispatch(u.side.addFiles([n.data.url])),r.complete&&r.complete(n.data)}}).done(function(){n.uploading=!1,r.completeAll&&r.completeAll()}).fail(function(e){n.uploading=!1,r.fail&&r.fail(e)}),o.promise()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(i),l=n(1),u=r(l),c=n(3),s=r(c)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u,c,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(0),p=o(d),h=n(6),m=n(44),v=o(m),b=n(4),y=o(b),g=n(1),_=r(g),E=n(3),O=r(E),w=[],I=(c=u=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return l(t,e),f(t,[{key:"_selectBlock",value:function(e,t){var n=this.props;if(null===e)return void n.dispatch(_.body.activeBlock([],!1));switch(n.keyboard.keyName){case"CMD":case"CTRL":case"SHIFT":if(O.object.isArray(n.tree.body.activeBlock)){var r=Object.assign([],n.tree.body.activeBlock);r.indexOf(e)>-1?r.splice(r.indexOf(e),1):r.push(e),n.dispatch(_.body.activeBlock(r,t))}else n.dispatch(_.body.activeBlock([e],t));break;default:n.dispatch(_.body.activeBlock([e],t))}}},{key:"_updateBlocks",value:function(e,t){var n=this.props;switch(e){case"start":w[0]=(new Date).getTime();break;case"end":if(w[1]=(new Date).getTime(),w[1]-w[0]>400){var r=n.tree.body.grid.map(function(e,n){return s({},e,{layout:{x:t[n].x,y:t[n].y,w:t[n].w,h:t[n].h}})});n.dispatch(_.body.updateBlocks(r))}w=[]}}},{key:"renderItem",value:function(e,t){var n=this,r=this.props,o=r.tree.body.activeBlock,i=e.indexPrefix+"__"+e.index,a=!!(o&&o.length&&o.indexOf(e.index)>-1);return p.default.createElement("div",{key:i,"data-grid":e.layout,"data-index":e.index,onClick:function(t){t.stopPropagation(),n._selectBlock(e.index,!!e.image)},style:{backgroundColor:e.color||r.setting.body.blockColor},className:(0,y.default)({active:a})},e.image&&p.default.createElement("figure",{style:{backgroundImage:"url('"+e.image.src+"')",backgroundPosition:e.image.position,backgroundSize:e.image.size}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.tree.body.setting,r=n.width*n.column+n.innerMargin*(n.column-1)+2*n.outerMargin;return p.default.createElement("div",{className:"ple-grid__wrap",onClick:function(){return e._selectBlock(null)}},p.default.createElement(v.default,{autoSize:!0,cols:n.column,rowHeight:n.height,width:r,margin:[n.innerMargin,n.innerMargin],containerPadding:[n.outerMargin,n.outerMargin],verticalCompact:!n.freeMode,onDragStart:function(){return e._updateBlocks("start",null)},onDragStop:function(t){return e._updateBlocks("end",t)},onResizeStart:function(){return e._updateBlocks("start",null)},onResizeStop:function(t){return e._updateBlocks("end",t)},style:{width:r+"px"},className:"ple-grid"},t.tree.body.grid.map(this.renderItem.bind(this))))}}]),t}(p.default.Component),u.displayName="GridLayout",u.defaultProps={tree:null,ple:null,dispatch:null},c);t.default=(0,h.connect)(function(e){return Object.assign({},e,{})})(I)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,l,u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),s=function(e){return e&&e.__esModule?e:{default:e}}(c),f=(l=a=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,r=e.iconClass,o=e.className,i=e.onClick;return s.default.createElement("div",{className:"block "+(o||"")},s.default.createElement("button",{type:"button",title:n,onClick:i},s.default.createElement("i",{className:"sp-ico abs "+r},n)),t&&s.default.createElement("div",{className:"pop"},t))}}]),t}(s.default.Component),a.displayName="Button",l);t.default=f},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,u,c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(0),d=function(e){return e&&e.__esModule?e:{default:e}}(f),p=(u=l=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=c({},e.defaultSetting,e.setting),n}return a(t,e),s(t,[{key:"componentWillReceiveProps",value:function(){this.setState(c({},this.props.defaultSetting,this.props.setting))}},{key:"_reset",value:function(){this.setState(c({},this.props.defaultSetting))}},{key:"_change",value:function(e){this.setState(r({},e.target.name,parseInt(e.target.value)))}},{key:"render",value:function(){var e=this,t=this.state,n=this.props;return d.default.createElement("form",{onSubmit:function(e){n.submit(t),e.preventDefault()}},d.default.createElement("fieldset",null,d.default.createElement("legend",null,"Settings form"),d.default.createElement("h1",null,"Settings"),d.default.createElement("dl",null,d.default.createElement("dt",null,d.default.createElement("label",{htmlFor:"frm_width"},"Width")),d.default.createElement("dd",{className:"type-input"},d.default.createElement("input",{type:"number",name:"width",id:"frm_width",min:1,max:999,maxLength:3,value:this.state.width,onChange:this._change.bind(this),required:!0}),d.default.createElement("span",null,"px"))),d.default.createElement("dl",null,d.default.createElement("dt",null,d.default.createElement("label",{htmlFor:"frm_height"},"Height")),d.default.createElement("dd",{className:"type-input"},d.default.createElement("input",{type:"number",name:"height",id:"frm_height",min:1,max:999,value:this.state.height,onChange:this._change.bind(this),required:!0}),d.default.createElement("span",null,"px"))),d.default.createElement("dl",null,d.default.createElement("dt",null,d.default.createElement("label",{htmlFor:"frm_column"},"Column")),d.default.createElement("dd",{className:"type-input"},d.default.createElement("input",{type:"number",name:"column",id:"frm_column",min:1,max:99,value:this.state.column,onChange:this._change.bind(this),required:!0}),d.default.createElement("span",null,"ea"))),d.default.createElement("dl",{className:"type-input"},d.default.createElement("dt",null,d.default.createElement("label",{htmlFor:"frm_outerMargin"},"Outer margin")),d.default.createElement("dd",null,d.default.createElement("input",{type:"number",name:"outerMargin",id:"frm_outerMargin",min:0,max:500,value:this.state.outerMargin,onChange:this._change.bind(this),required:!0}),d.default.createElement("span",null,"px"))),d.default.createElement("dl",{className:"type-input"},d.default.createElement("dt",null,d.default.createElement("label",{htmlFor:"frm_innerMargin"},"Inner margin")),d.default.createElement("dd",null,d.default.createElement("input",{type:"number",name:"innerMargin",id:"frm_innerMargin",min:0,max:500,value:this.state.innerMargin,onChange:this._change.bind(this),required:!0}),d.default.createElement("span",null,"px"))),d.default.createElement("dl",null,d.default.createElement("dt",null,d.default.createElement("label",{htmlFor:"frm_freeMode"},"Free mode")),d.default.createElement("dd",{className:"type-checkbox"},d.default.createElement("label",null,d.default.createElement("input",{type:"radio",name:"freeMode",id:"frm_freeMode",onChange:function(){return e.setState({freeMode:!0})},checked:this.state.freeMode}),d.default.createElement("span",null,"true")),d.default.createElement("label",null,d.default.createElement("input",{type:"radio",name:"freeMode",onChange:function(){return e.setState({freeMode:!1})},checked:!this.state.freeMode}),d.default.createElement("span",null,"false"))))),d.default.createElement("nav",null,d.default.createElement("span",null,d.default.createElement("button",{type:"button",onClick:this._reset.bind(this)},"Reset")),d.default.createElement("span",null,d.default.createElement("button",{type:"submit",className:"submit"},"Apply"))))}}]),t}(d.default.Component),l.displayName="EditLayoutSetting",l.defaultProps={submit:function(){},setting:null,defaultSetting:{width:100,height:100,column:5,outerMargin:10,innerMargin:10,freeMode:!1}},u);t.default=p},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c,s,f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=n(0),h=o(p),m=n(4),v=o(m),b=n(6),y=n(5),g=o(y),_=n(45),E=o(_),O=n(9),w=n(1),I=r(w),k=n(3),P=r(k),j=n(18),S=o(j),C=n(19),T=o(C),M=(s=c=function(e){function t(e){a(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={active:{setting:!1,editBlockColor:!1}},n}return u(t,e),d(t,[{key:"changeActive",value:function(e,t,n){var r=this,o=this.state,a=t||!o.active[e],l=n?n.currentTarget:null;a?(0,g.default)(document).on("click.pleToolbar",function(t){(0,g.default)(t.target).closest(".pop").length||t.target!==l&&t.target.parentNode!==l&&r.changeActive(e,!1)}):(0,g.default)(document).off("click.pleToolbar"),this.setState({active:f({},o.active,i({setting:!1,editColor:!1},e,a))})}},{key:"deactivate",value:function(){var e=this;return(0,g.default)(document).off("click.pleToolbar"),new Promise(function(t){e.setState({active:{setting:!1,editColor:!1}},t)})}},{key:"submitEditSetting",value:function(e){return this.props.dispatch(I.body.updateSetting(e)),this.changeActive("setting",!1),!1}},{key:"_onClickEdit",value:function(){var e=this.props;e.api.cropper.open(e.tree.body.activeBlock[0])}},{key:"render",value:function(){var e=this,t=this.state,n=this.props,r=n.tree.body.visibleToolbarButtons,o="#fff";if(P.object.isArray(n.tree.body.grid)&&P.object.isArray(n.tree.body.activeBlock)){var i=(0,O.findObjectValueInArray)(n.tree.body.grid,"index",n.tree.body.activeBlock[0]);o=n.tree.body.grid[i]&&n.tree.body.grid[i].color?n.tree.body.grid[i].color:n.setting.body.blockColor}return h.default.createElement("nav",{className:"ple-toolbar"},h.default.createElement("div",{className:"wrap"},r.setting&&h.default.createElement(S.default,{iconClass:"ico-setting",className:(0,v.default)("edit-setting",{active:t.active.setting}),onClick:function(n){n.persist(),t.active.setting||e.deactivate().then(function(){e.changeActive("setting",null,n)})},title:"Edit preference"},h.default.createElement(T.default,{submit:this.submitEditSetting.bind(this),setting:n.tree.body.setting,defaultSetting:n.setting.body.setting})),r.shuffle&&h.default.createElement(S.default,{iconClass:"ico-arrow-random",onClick:function(){return n.dispatch(I.body.shuffleBlocks({x:n.tree.body.setting.column,y:2,w:2,h:2}))},title:"Shuffle block"}),r.add&&h.default.createElement(S.default,{iconClass:"ico-plus",onClick:function(){return n.dispatch(I.body.addBlock({layout:{x:n.tree.body.grid.length%n.tree.body.setting.column,y:1/0,w:1,h:1}}))},title:"Add block"}),r.select&&h.default.createElement(S.default,{iconClass:"ico-select",onClick:function(){if(P.object.isArray(n.tree.body.activeBlock))return void n.dispatch(I.body.activeBlock(null));var e=[],t=!(!n.tree.body.grid[0]||!n.tree.body.grid[0].image);n.tree.body.grid.forEach(function(t){return e.push(t.index)}),n.dispatch(I.body.activeBlock(e,t))},title:"Toggle select block"}),r.edit&&h.default.createElement(S.default,{iconClass:"ico-pencil",className:"key",onClick:this._onClickEdit.bind(this),title:"Edit block"}),r.removeImage&&h.default.createElement(S.default,{iconClass:"ico-empty",className:"key",onClick:function(){return n.dispatch(I.body.removeImages(n.tree.body.activeBlock))},title:"Remove image in block"}),r.duplicate&&h.default.createElement(S.default,{iconClass:"ico-duplicate",className:"key",onClick:function(){if(null===n.tree.body.activeBlock)return void alert("Not found select block");n.dispatch(I.body.duplicateBlock(n.tree.body.activeBlock))},title:"Duplicate block"}),r.removeBlock&&h.default.createElement(S.default,{iconClass:"ico-trash",className:"key",onClick:function(){if(null===n.tree.body.activeBlock)return void alert("Not found select block");n.dispatch(I.body.removeBlock(n.tree.body.activeBlock))},title:"Remove block"}),r.editColor&&h.default.createElement(S.default,{iconClass:"ico-palette",className:"edit-color key "+(t.active.editColor?"active":""),onClick:function(n){n.persist(),t.active.editColor||e.deactivate().then(function(){return e.changeActive("editColor",null,n)})},title:"Change color"},h.default.createElement("div",{className:"colorPicker__wrap"},h.default.createElement(E.default,{onChange:function(e){e&&n.dispatch(I.body.changeColorBlock(n.tree.body.activeBlock,e))},color:o})))))}}]),t}(h.default.Component),c.displayName="Toolbar",c.defaultProps={dispatch:null,tree:null},s);t.default=(0,b.connect)(function(e){return Object.assign({},e,{})})(M)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(17),p=r(d),h=n(20),m=r(h),v=(u=l=function(e){function t(e){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,e),c(t,[{key:"render",value:function(){return f.default.createElement("div",{className:"ple-container"},f.default.createElement("div",{className:"ple-body"},f.default.createElement(m.default,null),f.default.createElement(p.default,null)))}}]),t}(f.default.Component),l.displayName="Body",u);t.default=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(43),p=r(d),h=n(5),m=r(h),v=n(4),b=r(v),y=n(3),g={start:y.util.isTouchDevice()?"touchstart":"mousedown",move:y.util.isTouchDevice()?"touchmove":"mousemove",end:y.util.isTouchDevice()?"touchend":"mouseup"},_=(u=l=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={position:e.position,size:e.size,isCover:"cover"===e.size},n.$self=null,n.$img=null,n.moveStartInfo={},n.resizeStartInfo={},n}return a(t,e),c(t,[{key:"componentDidMount",value:function(){this.$self=(0,m.default)(p.default.findDOMNode(this.refs.self))}},{key:"componentWillReceiveProps",value:function(e){this.props.size!==e.size&&this.setState({position:e.position,size:e.size,isCover:"cover"===e.size})}},{key:"_moveStart",value:function(e){e.stopPropagation();var t=this.state;this.$img=this.$self.find("img"),this.moveStartInfo={containerX:parseInt(t.position.split(" ")[0]),containerY:parseInt(t.position.split(" ")[1]),mouseX:(e.clientX||e.pageX||e.nativeEvent.touches[0].clientX)+(0,m.default)(window).scrollLeft(),mouseY:(e.clientY||e.pageY||e.nativeEvent.touches[0].clientY)+(0,m.default)(window).scrollTop()},(0,m.default)(document).on(g.move+".move",this._moveIng.bind(this)).on(g.end+".move",this._moveEnd.bind(this))}},{key:"_moveIng",value:function(e){e.stopPropagation();var t="touchmove"===e.type?e.originalEvent.touches[0]:e,n={},r={};n.x=(t.clientX||t.pageX)+(0,m.default)(window).scrollLeft(),n.y=(t.clientY||t.pageY)+(0,m.default)(window).scrollTop(),r.x=this.moveStartInfo.containerX+(n.x-this.moveStartInfo.mouseX),r.y=this.moveStartInfo.containerY+(n.y-this.moveStartInfo.mouseY),this.setState({position:parseInt(r.x)+"px "+parseInt(r.y)+"px"})}},{key:"_moveEnd",value:function(e){e.preventDefault(),this.$img=null,this.moveStartInfo=null,(0,m.default)(document).off(g.move+".move").off(g.end+".move")}},{key:"_resizeStart",value:function(e){e.stopPropagation();var t=this.state;this.$img=this.$self.find("img"),this.resizeStartInfo={title:e.currentTarget.title,width:this.$img.width(),height:this.$img.height(),mouseX:(e.clientX||e.pageX||e.nativeEvent.touches[0].clientX)+(0,m.default)(window).scrollLeft(),posX:parseInt(t.position.split(" ")[0]),posY:parseInt(t.position.split(" ")[1])},(0,m.default)(document).on(g.move+".resize",this._resizeIng.bind(this)).on(g.end+".resize",this._resizeEnd.bind(this))}},{key:"_resizeIng",value:function(e){e.stopPropagation();var t={},n={},r=1,o=0,i="touchmove"===e.type?e.originalEvent.touches[0]:e,a=(i.clientX||i.pageX)+(0,m.default)(window).scrollLeft()-this.resizeStartInfo.mouseX;switch(this.resizeStartInfo.title){case"resize-lt":n.x=this.resizeStartInfo.posX+a,t.width=this.resizeStartInfo.width-a,r=t.width/this.$img.get(0).naturalWidth,t.height=parseInt(this.$img.get(0).naturalHeight*r),o=this.resizeStartInfo.height-t.height,n.y=this.resizeStartInfo.posY+o;break;case"resize-rt":n.x=this.resizeStartInfo.posX,t.width=this.resizeStartInfo.width+a,r=t.width/this.$img.get(0).naturalWidth,t.height=parseInt(this.$img.get(0).naturalHeight*r),o=this.resizeStartInfo.height-t.height,n.y=this.resizeStartInfo.posY+o;break;case"resize-lb":n.x=this.resizeStartInfo.posX+a,n.y=this.resizeStartInfo.posY,t.width=this.resizeStartInfo.width-a,r=t.width/this.$img.get(0).naturalWidth,t.height=parseInt(this.$img.get(0).naturalHeight*r);break;case"resize-rb":n.x=this.resizeStartInfo.posX,n.y=this.resizeStartInfo.posY,t.width=this.resizeStartInfo.width+a,r=t.width/this.$img.get(0).naturalWidth,t.height=parseInt(this.$img.get(0).naturalHeight*r);break;default:return}this.setState({size:parseInt(t.width)+"px "+parseInt(t.height)+"px",position:parseInt(n.x)+"px "+parseInt(n.y)+"px"})}},{key:"_resizeEnd",value:function(e){this.$img=null,this.resizeStartInfo=null,(0,m.default)(document).off(g.move+".resize").off(g.end+".resize")}},{key:"render",value:function(){var e=this.state,t=this.props,n="cover"!==e.size?e.size.split(" "):e.size,r=e.position.split(" ");return f.default.createElement("figure",{ref:"self",style:{backgroundColor:t.bgColor},className:"ple-cropperBlock ple-cropper__block"},e.isCover?f.default.createElement("span",{style:{backgroundImage:"url('"+t.src+"')"},className:"ple-cropperBlock__image ple-cropperBlock__image-cover"}):f.default.createElement("span",{className:(0,b.default)("ple-cropperBlock__image",{"ple-cropperBlock__image-resize":"cover"!==t.size})},f.default.createElement("img",{src:t.src,style:Object.assign({},"cover"!==e.size&&{width:n[0],transform:"translate("+r[0]+", "+r[1]+")"}),alt:"image"})),f.default.createElement("div",{onMouseDown:this._moveStart.bind(this),onTouchStart:this._moveStart.bind(this),style:Object.assign({},"cover"!==e.size&&{width:n[0],height:n[1],transform:"translate("+r[0]+", "+r[1]+")"}),className:(0,b.default)("ple-cropperBlock__control",{"ple-cropperBlock__control-active":"cover"!==t.size})},f.default.createElement("button",{type:"button",title:"resize-lt",onMouseDown:this._resizeStart.bind(this),onTouchStart:this._resizeStart.bind(this),className:"ple-cropperBlock__resize ple-cropperBlock__resize-lt"},f.default.createElement("i",{className:"sp-ico abs ico-clamp"})),f.default.createElement("button",{type:"button",title:"resize-rt",onMouseDown:this._resizeStart.bind(this),onTouchStart:this._resizeStart.bind(this),className:"ple-cropperBlock__resize ple-cropperBlock__resize-rt"},f.default.createElement("i",{className:"sp-ico abs ico-clamp"})),f.default.createElement("button",{type:"button",title:"resize-lb",onMouseDown:this._resizeStart.bind(this),onTouchStart:this._resizeStart.bind(this),className:"ple-cropperBlock__resize ple-cropperBlock__resize-lb"},f.default.createElement("i",{className:"sp-ico abs ico-clamp"})),f.default.createElement("button",{type:"button",title:"resize-rb",onMouseDown:this._resizeStart.bind(this),onTouchStart:this._resizeStart.bind(this),className:"ple-cropperBlock__resize ple-cropperBlock__resize-rb"},f.default.createElement("i",{className:"sp-ico abs ico-clamp"}))))}}]),t}(f.default.Component),l.displayName="Block",l.defaultProps={src:"",position:"",size:"",bgColor:"#fff"},u);t.default=_},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u,c,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(0),d=o(f),p=n(6),h=n(5),m=o(h),v=n(4),b=o(v),y=n(22),g=o(y),_=n(1),E=r(_),O=n(3),w=r(O),I=(c=u=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.tree.cropper;return n.imageMeta=null,n._block=null,n.$item=(0,m.default)(e.element).find(".react-grid-item").filter("[data-index="+e.tree.cropper.item.index+"]"),n.state={pending:!0,position:r.item.image.position,size:r.item.image.size||"cover",width:n.$item.width(),height:n.$item.height(),top:n.$item.offset().top,left:n.$item.offset().left},n}return l(t,e),s(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.tree.cropper;w.util.getImageSize(n.item.image.src).then(function(t){e.imageMeta=t,e.setState({pending:!1})})}},{key:"_onClose",value:function(){var e=this.props;e.dispatch(E.cropper.close({index:e.tree.cropper.item.index,position:this._block.state.position,size:this._block.state.size}))}},{key:"_toggleImageType",value:function(){var e=this.state;if(this.props,"cover"===e.size){var t="",n=0;e.height>e.width?(n=w.number.getRatioForResize(e.height,this.imageMeta.height),t=parseInt(this.imageMeta.width*n)+"px "+e.height+"px"):(n=w.number.getRatioForResize(e.width,this.imageMeta.width),t=e.width+"px "+parseInt(this.imageMeta.height*n)+"px"),this.setState({position:"0 0",size:t})}else this.setState({position:"50% 50%",size:"cover"})}},{key:"render",value:function(){var e=this,t=this.state,n=this.props;return t.pending?null:d.default.createElement("div",{className:"ple-cropper"},d.default.createElement("span",{className:"ple-cropper__bg"}),d.default.createElement("div",{style:{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px"},className:"ple-cropper__wrap"},d.default.createElement(g.default,{ref:function(t){e._block=t},src:n.tree.cropper.item.image.src,position:t.position,size:t.size,bgColor:n.tree.cropper.item.color||n.setting.body.blockColor}),d.default.createElement("nav",{className:"ple-cropper__nav"},d.default.createElement("button",{type:"button",onClick:this._onClose.bind(this)},d.default.createElement("i",{className:"sp-ico ico-close abs"},"Close cropper")),d.default.createElement("button",{type:"button",onClick:this._toggleImageType.bind(this),className:(0,b.default)({active:"cover"!==t.size})},d.default.createElement("i",{className:"sp-ico ico-resize abs"},"Toggle background size type")))))}}]),t}(d.default.Component),u.displayName="Cropper",c);t.default=(0,p.connect)(function(e){return Object.assign({},e,{})})(I)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,u,c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(0),d=r(f),p=n(4),h=r(p),m=n(3),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(m),b=(u=l=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=Object.assign({},v.util.isTouchDevice()?{onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd}:{onDragStart:e.onDragStart,onDragEnd:e.onDragEnd});return d.default.createElement("li",null,d.default.createElement("button",c({type:"button","data-id":e.id,"data-image":e.image,draggable:!0,onClick:e.onClick},t,{style:{backgroundImage:"url('"+e.image+"')"},className:(0,h.default)({active:e.active})})))}}]),t}(d.default.Component),l.displayName="Item",l.defaultProps={image:null,id:null,active:null,onClick:null,onDragStart:null,onDragEnd:null,onTouchStart:null,onTouchMove:null,onTouchEnd:null},u);t.default=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(24),p=r(d),h=(u=l=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),c(t,[{key:"render",value:function(){var e=this.props;return f.default.createElement("div",{className:"items"},f.default.createElement("div",{className:"wrap"},f.default.createElement("ul",null,e.files.map(function(t,n){return f.default.createElement(p.default,{key:n,id:t.id,image:t.image,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd,onClick:function(){return e.onSelect(t.id)},active:t.active})}),null!==e.progress&&f.default.createElement("li",{className:"loading"},f.default.createElement("div",{className:"progress"},f.default.createElement("span",{className:"bar",style:{height:e.progress+"%"}}),f.default.createElement("span",{className:"percent"},e.progress+"%"))))))}}]),t}(f.default.Component),l.displayName="Items",l.defaultProps={files:[],onSelect:function(e){},onDragStart:null,onDragEnd:null,onTouchStart:null,onTouchMove:null,onTouchEnd:null,progress:null},u);t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,l,u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),s=function(e){return e&&e.__esModule?e:{default:e}}(c),f=(l=a=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={timestamp:Date.now()},n}return i(t,e),u(t,[{key:"upload",value:function(e){this.props.onUpload(e.target.files),this.setState({timestamp:Date.now()})}},{key:"render",value:function(){var e=this.props,t=this.state;return s.default.createElement("nav",{className:"navigation"},s.default.createElement("div",{className:"wrap"},s.default.createElement("button",{type:"button",title:"attach images",onClick:e.onAttach},s.default.createElement("i",{className:"sp-ico ico-reply abs"},"Moving the image to grid block")),s.default.createElement("button",{type:"button",title:"toggle select",onClick:e.onToggleSelect},s.default.createElement("i",{className:"sp-ico ico-select abs"},"Toggle all select")),s.default.createElement("span",{title:"upload images",key:t.timestamp},s.default.createElement("input",{type:"file",ref:"inputFile",onChange:this.upload.bind(this),multiple:!0}),s.default.createElement("i",{className:"sp-ico ico-upload abs"},"upload images")),s.default.createElement("button",{type:"button",title:"remove images",onClick:e.onRemove},s.default.createElement("i",{className:"sp-ico ico-trash abs"},"remove images"))))}}]),t}(s.default.Component),a.displayName="Navigation",a.defaultProps={onRemove:function(){},onToggleSelect:function(){},onAttach:function(){},onUpload:function(){}},l);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(4),p=r(d),h=(u=l=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),c(t,[{key:"render",value:function(){var e=this.props;return f.default.createElement("button",{type:"button",onClick:e.onClick,className:"toggle"},f.default.createElement("span",null,f.default.createElement("i",{className:(0,p.default)("sp-ico","abs",{"ico-arrow-right":e.show,"ico-arrow-left":!e.show})},"Toggle sidebar")))}}]),t}(s.Component),l.displayName="ToggleSideButton",l.defaultProps={show:!1,onClick:function(){}},u);t.default=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(6),p=n(4),h=r(p),m=n(5),v=r(m),b=n(1),y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(b),g=n(27),_=r(g),E=n(26),O=r(E),w=n(25),I=r(w),k=null,P=(u=l=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.dragType=null,n.dragTarget=null,n.dragPosition=[],n.$gridItems=null,n.$dragItem=null,n.uploading=!1,n}return a(t,e),c(t,[{key:"componentDidMount",value:function(){this.props}},{key:"getGridsterItem",value:function(){var e=this,t=this.props,n=null;return this.$gridItems=(0,v.default)(t.element).find(".ple-grid > div"),this.$gridItems.each(function(t,r){var o=(0,v.default)(r),i=o.offset();if(i.left<e.dragPosition[0]&&i.left+o.width()>e.dragPosition[0]&&i.top<e.dragPosition[1]&&i.top+o.height()>e.dragPosition[1])return n=o.data("index"),!1}),n}},{key:"_selectItem",value:function(e){var t=this.props,n=t.keyboard.keyName,r=null;if("SHIFT"!==n){var o=null;t.tree.side.files.forEach(function(t,n){if(t.id===e)return o=t,!1}),(k=!0===o.active?null:e)||!0!==o.active||(k=o.id)}switch(n){case"CTRL":case"CMD":r="add";break;case"SHIFT":r="range"}t.dispatch(y.side.changeActiveFile(k,e,r))}},{key:"_removeItems",value:function(){var e=this.props,t=[];e.tree.side.files.length&&(e.tree.side.files.forEach(function(e){e.active&&t.push(e.id)}),t.length||confirm("Delete all?")&&e.tree.side.files.forEach(function(e){t.push(e.id)}),e.dispatch(y.side.removeFiles(t)))}},{key:"_toggleSelect",value:function(){var e=this.props,t="all";e.tree.side.files.some(function(e){return e.active&&(t="none"),e.active}),e.dispatch(y.side.changeActiveFile(null,null,t))}},{key:"_upload",value:function(e){this.props.api.side.upload(e)}},{key:"_attach",value:function(){var e=this.props,t=[];if(e.tree.side.files.forEach(function(e,n){e.active&&t.push(e.image)}),!t.length)return void alert("not select image");e.dispatch(y.body.attachImages(t,e.tree.body.setting.column,e.tree.body.activeBlock))}},{key:"_dragStartItem",value:function(e){var t=this,n=this.props;this.$gridItems=(0,v.default)(n.element).find(".ple-grid > div"),this.$gridItems.on("dragover",function(e){e.preventDefault(),(0,v.default)(e.currentTarget).hasClass("hover")||(0,v.default)(e.currentTarget).addClass("hover")}).on("dragleave",function(e){e.preventDefault(),(0,v.default)(e.currentTarget).removeClass("hover")}).on("drop",function(e){e.preventDefault(),(0,v.default)(e.currentTarget).removeClass("hover"),t.dragTarget=(0,v.default)(e.currentTarget).data("index")})}},{key:"_dragEndItem",value:function(e){var t=this.props;this.$gridItems.off(),this.$gridItems=null,null!==this.dragTarget&&(t.dispatch(y.body.attachImage(this.dragTarget,(0,v.default)(e.currentTarget).data("image"))),this.dragTarget=null)}},{key:"_touchStartItem",value:function(e){this.$dragItem=(0,v.default)(e.currentTarget).clone().removeAttr("draggable").addClass("ple-side__placeholder").width((0,v.default)(e.currentTarget).width()).height((0,v.default)(e.currentTarget).height()),(0,v.default)("body").append(this.$dragItem)}},{key:"_touchMoveItem",value:function(e){var t=e.nativeEvent.touches[0];this.dragPosition=[t.pageX,t.pageY],this.$dragItem.css({left:t.pageX-.5*this.$dragItem.width(),top:t.pageY-.5*this.$dragItem.height()})}},{key:"_touchEndItem",value:function(e){var t=this.props;if(this.$dragItem.remove(),this.$dragItem=null,this.dragPosition.length>0){if(this.dragTarget=this.getGridsterItem(),null===this.dragTarget)return;t.dispatch(y.body.attachImage(this.dragTarget,(0,v.default)(e.currentTarget).data("image"))),this.dragPosition=[]}else this._selectItem((0,v.default)(e.currentTarget).data("id"))}},{key:"render",value:function(){var e=this.props;return f.default.createElement("aside",{className:"ple-side"},f.default.createElement("div",{className:(0,h.default)("wrap",{show:e.tree.side.visible})},f.default.createElement("span",{onClick:function(){return e.dispatch(y.side.changeActiveFile(null,null,"none"))},className:"background"}),f.default.createElement(_.default,{show:e.tree.side.visible,onClick:function(){return e.api.layout.toggleSide(void 0)}}),f.default.createElement(O.default,{onAttach:this._attach.bind(this),onToggleSelect:this._toggleSelect.bind(this),onUpload:this._upload.bind(this),onRemove:this._removeItems.bind(this)}),f.default.createElement(I.default,{files:e.tree.side.files,onSelect:this._selectItem.bind(this),onDragStart:this._dragStartItem.bind(this),onDragEnd:this._dragEndItem.bind(this),onTouchStart:this._touchStartItem.bind(this),onTouchMove:this._touchMoveItem.bind(this),onTouchEnd:this._touchEndItem.bind(this),progress:e.tree.side.progressPercent})))}}]),t}(f.default.Component),l.displayName="Side",l.defaultProps={tree:{},setting:{},api:{},dispatch:null},u);t.default=(0,d.connect)(function(e){return Object.assign({},e,{})})(P)},function(e,t,n){"use strict";function r(e){return{type:m.GRID_ADD_BLOCK,value:e}}function o(e){return{type:m.GRID_REMOVE_BLOCK,index:e}}function i(e){return{type:m.GRID_SHUFFLE_BLOCKS,value:e}}function a(e){return{type:m.GRID_DUPLICATE_BLOCK,index:e}}function l(e){return{type:m.GRID_UPDATE_BLOCKS,value:e}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:m.GRID_ACTIVE_BLOCK,value:e,isImage:t}}function c(e,t){return{type:m.GRID_CHANGE_COLOR,item:e,color:t}}function s(e){return{type:m.GRID_SETTING_UPDATE,value:e}}function f(e,t,n){return{type:m.ATTACH_IMAGES,value:e,columns:t,activeBlocks:n}}function d(e,t){return{type:m.ATTACH_IMAGE,index:e,image:t}}function p(e){return{type:m.GRID_REMOVE_IMAGES,value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.addBlock=r,t.removeBlock=o,t.shuffleBlocks=i,t.duplicateBlock=a,t.updateBlocks=l,t.activeBlock=u,t.changeColorBlock=c,t.updateSetting=s,t.attachImages=f,t.attachImage=d,t.removeImages=p;var h=n(2),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(h)},function(e,t,n){"use strict";function r(e,t,n){return{type:i.INIT_PLE,api:e,preference:t,element:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.init=r;var o=n(2),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o)},function(e,t,n){"use strict";function r(e){return{type:a.CROPPER_OPEN,value:e}}function o(e){return{type:a.CROPPER_CLOSE,value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.open=r,t.close=o;var i=n(2),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i)},function(e,t,n){"use strict";function r(e){return{type:s.SIDE_VISIBLE,value:e}}function o(){return{type:s.SIDE_TOGGLE}}function i(e){return{type:s.SIDE_ADD_FILES,files:e}}function a(e){return{type:s.SIDE_REMOVE_FILES,ids:e}}function l(e,t,n){return{type:s.SIDE_CHANGE_ACTIVE_FILE,start:e,end:t,selectType:n}}function u(e){return{type:s.SIDE_UPDATE_PROGRESS,value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.visible=r,t.toggle=o,t.addFiles=i,t.removeFiles=a,t.changeActiveFile=l,t.updateProgress=u;var c=n(2),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(c)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,u,c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(0),f=r(s),d=n(8),p=n(6),h=n(11),m=r(h),v=n(12),b=r(v),y=n(10),g=r(y),_=(u=l=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.store=(0,d.createStore)(b.default),e.api=new g.default(e.store),e}return a(t,e),c(t,[{key:"render",value:function(){var e=this.props;return f.default.createElement(p.Provider,{store:this.store},f.default.createElement(m.default,{parent:{preference:e,api:this.api}}))}}]),t}(f.default.Component),l.displayName="PhotoLayoutEditor",u);t.default=_,e.exports=_},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(i),l=n(3),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(l),c=function(){function e(){r(this,e),this.eventName="PLE_"+u.number.getTimeStamp(),this.code=null,this.keyName=null,this.names={17:"CTRL",18:"ALT",91:"CMD",93:"CMD",16:"SHIFT"},(0,a.default)(window).on("keydown."+this.eventName,this._keyDown.bind(this))}return o(e,[{key:"apply",value:function(e){this.code=e,this.keyName=this.names[this.code]||null}},{key:"_keyDown",value:function(e){this.apply(e.keyCode),(0,a.default)(window).on("keyup."+this.eventName,this._keyUp.bind(this)).on("contextmenu."+this.eventName,this._keyUp.bind(this)).on("blur."+this.eventName,this._keyUp.bind(this)).off("keydown."+this.eventName)}},{key:"_keyUp",value:function(){this.apply(null),(0,a.default)(window).on("keydown."+this.eventName,this._keyDown.bind(this)).off("contextmenu."+this.eventName+" keyup."+this.eventName+" blur."+this.eventName)}},{key:"destroy",value:function(){(0,a.default)(window).off("keydown."+this.eventName+" contextmenu."+this.eventName+" keyup."+this.eventName+" blur."+this.eventName)}}]),e}();t.default=c},function(e,t,n){"use strict";function r(e){return e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""}Object.defineProperty(t,"__esModule",{value:!0}),t.rgbToHex=r},function(e,t,n){"use strict";function r(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.random()*(t-e)+e:Math.floor(Math.random()*(t-e+1))+e}function o(e,t){return t>e?e/t:t/e}function i(){return Math.round(+new Date/1e3)}Object.defineProperty(t,"__esModule",{value:!0}),t.randomRange=r,t.getRatioForResize=o,t.getTimeStamp=i},function(e,t,n){"use strict";function r(e){var t=u.default.Deferred(),n=new FileReader;return n.addEventListener("load",function(e){t.resolve(e.target.result)}),n.addEventListener("error",function(e){t.reject(e.target)}),n.readAsDataURL(e),t.promise()}function o(e,t){function n(e){try{var t=JSON.parse(e.target.responseText);if("success"!==t.state)throw"server error";o.resolve(t.data)}catch(e){o.reject(e)}}function r(e){var t=e.loaded,n=e.total;o.notify("progress",t,n)}var o=u.default.Deferred(),i=new XMLHttpRequest;if("function"!=typeof FormData&&"object"!==("undefined"==typeof FormData?"undefined":a(FormData)))return o.reject("not support browser",t),null;var l=new FormData;return l.append("files[]",t),i.open("post",e,!0),i.addEventListener("load",n),i.upload.addEventListener("progress",r),i.send(l),o.notify("start"),o.promise()}function i(e,t){function n(){if(l>=a)return void i.resolve();t?o(t,e[l]).done(function(e){i.notify("done",{count:l,data:e}),l++,n()}).progress(function(e,t,n){i.notify(e,"progress"===e&&{loaded:t,total:n})}).fail(function(e){i.reject(e)}):r(e[l]).done(function(e){i.notify("done",{count:l,src:e}),l++,n()}).fail(function(){})}var i=u.default.Deferred(),a=e.length,l=0;return n(0),i.promise()}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=i;var l=n(5),u=function(e){return e&&e.__esModule?e:{default:e}}(l)},function(e,t,n){"use strict";function r(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pleTimer";return new Promise(function(n){window[t]=setTimeout(n,e)})}function i(e){return new Promise(function(t,n){e&&"string"==typeof e||n();var r=document.createElement("img");r.onload=function(){t({width:r.naturalWidth,height:r.naturalHeight,ratio:r.naturalHeight/r.naturalWidth})},r.onerror=function(){n()},r.src=e})}Object.defineProperty(t,"__esModule",{value:!0}),t.isTouchDevice=r,t.sleep=o,t.getImageSize=i,t.cssPrefix=function(){var e=window.getComputedStyle(document.documentElement,""),t=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1];return{dom:"WebKit|Moz|MS|O".match(new RegExp("("+t+")","i"))[1],lowercase:t,css:"-"+t+"-",js:t[0].toUpperCase()+t.substr(1)}}()},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.setting.body.setting,t=arguments[1];switch(t.type){case s.INIT_PLE:try{return u({},e,t.preference.body.setting)}catch(t){return e}case s.GRID_SETTING_UPDATE:return u({},e,t.value)}return e}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.body.visibleToolbarButtons,t=arguments[1];switch(t.type){case s.GRID_ACTIVE_BLOCK:return t.value&&t.value.length?Object.assign({},e,{removeImage:!0,duplicate:!0,removeBlock:!0,editColor:!0},t.isImage&&1===t.value.length?{edit:!0}:{edit:!1}):u({},e,{edit:!1,removeImage:!1,duplicate:!1,removeBlock:!1,editColor:!1});case s.GRID_REMOVE_BLOCK:return u({},e,{edit:!1,removeImage:!1,duplicate:!1,removeBlock:!1,editColor:!1});case s.GRID_REMOVE_IMAGES:return u({},e,{edit:!1})}return e}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.setting.body.grid,t=arguments[1],n=null,r=null;switch(t.type){case s.INIT_PLE:var o=[];try{o=t.preference.body.grid||e}catch(t){o=e}return o.map(function(e,t){return m=null===m?0:m+1,u({color:null},e,{index:m,indexPrefix:v})});case s.GRID_ADD_BLOCK:return m=null===m?0:m+1,e.concat(u({color:null,layout:{x:1/0,y:1/0,w:1,h:1}},t.value,{index:m,indexPrefix:v}));case s.GRID_REMOVE_BLOCK:if(!t.index||!t.index.length)return e;n=Object.assign([],e);for(var i=0;i<t.index.length;i++){var a=d.object.findObjectValueInArray(n,"index",t.index[i]);n.splice(a,1)}return n;case s.GRID_SHUFFLE_BLOCKS:return v++,n=Object.assign([],e),n.map(function(e,n){return u({},e,{layout:{x:d.number.randomRange(0,t.value.x-1),y:d.number.randomRange(0,t.value.y-1),w:d.number.randomRange(1,t.value.w),h:d.number.randomRange(1,t.value.h)},indexPrefix:v})});case s.GRID_DUPLICATE_BLOCK:return n=Object.assign([],e),t.index.forEach(function(t,o){r=d.object.findObjectValueInArray(e,"index",t),n[r]&&(m=null===m?0:m+1,n=n.concat(u({},n[r],{index:m})))}),n;case s.GRID_CHANGE_COLOR:return n=Object.assign([],e),t.item.forEach(function(e,o){r=d.object.findObjectValueInArray(n,"index",e),n[r]&&(n[r].color=t.color)}),n;case s.ATTACH_IMAGES:return d.object.isArray(t.value)?(n=Object.assign([],e),t.activeBlocks&&t.activeBlocks.length?n.forEach(function(e,n){t.value.length&&(t.activeBlocks.indexOf(e.index)<0||(e.image={src:t.value.splice(0,1)[0],position:"50% 50%",size:"cover"}))}):(n.forEach(function(e){e.image||t.value&&t.value.length&&(e.image={src:t.value.splice(0,1)[0],position:"50% 50%",size:"cover"})}),t.value.length&&t.value.forEach(function(r,o){m=null===m?0:m+1,n=n.concat({color:null,layout:{x:(e.length+o)%t.columns,y:1/0,w:1,h:1},image:{src:r,position:"50% 50%",size:"cover"},index:m})})),n):e;case s.ATTACH_IMAGE:return t.image&&"string"==typeof t.image?null===t.index||"number"!=typeof t.index?e:(n=Object.assign([],e),r=d.object.findObjectValueInArray(n,"index",t.index),n[r].image={src:t.image,position:"50% 50%",size:"cover"},n):e;case s.GRID_REMOVE_IMAGES:return n=Object.assign([],e),t.value.forEach(function(e){r=d.object.findObjectValueInArray(n,"index",e),n[r]&&n[r].image&&delete n[r].image}),n;case s.GRID_UPDATE_BLOCKS:return Object.assign([],e,t.value);case s.CROPPER_CLOSE:return n=Object.assign([],e),r=d.object.findObjectValueInArray(e,"index",t.value.index),n[r].image.position=t.value.position,n[r].image.size=t.value.size,n}return e}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],n=null;switch(t.type){case s.GRID_ACTIVE_BLOCK:return t.value;case s.GRID_REMOVE_BLOCK:return t.index&&t.index.length?(n=Object.assign([],e),t.index.forEach(function(e,t){n.indexOf(e)<0||n.splice(n.indexOf(e),1)}),n):[]}return e}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.setting=o,t.visibleToolbarButtons=i,t.grid=a,t.activeBlock=l;var c=n(2),s=r(c),f=n(3),d=r(f),p=n(7),h=r(p),m=null,v=0},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1];switch(t.type){case s.INIT_PLE:return Object.assign({},{base:u({},h.setting.base,{uploadScript:t.preference.uploadScript||h.setting.base.uploadScript,uploadParamsConvertFunc:t.preference.uploadParamsConvertFunc||h.setting.base.uploadParamsConvertFunc}),side:u({},h.setting.side,t.preference.side),body:u({},h.setting.body,t.preference.body)});default:return e}}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1];switch(t.type){case s.INIT_PLE:return t.api;default:return e}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(arguments[1].type){case s.INIT_PLE:return new d.default;default:return e}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1];switch(t.type){case s.INIT_PLE:return t.element;default:return e}}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.setting=o,t.api=i,t.keyboard=a,t.element=l;var c=n(2),s=r(c),f=n(34),d=function(e){return e&&e.__esModule?e:{default:e}}(f),p=n(7),h=r(p)},function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch(arguments[1].type){case a.CROPPER_OPEN:return!0;case a.CROPPER_CLOSE:return!1;default:return e}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments[1];switch(t.type){case a.CROPPER_OPEN:return t.value;default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.visible=r,t.item=o;var i=n(2),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t,n,r,o){switch(r){case"all":return Object.assign({},e,{active:!0});case"none":return Object.assign({},e,{active:!1});case"add":return e.id===n?Object.assign({},e,{active:!e.active}):e;case"range":return t=t||0,t<n?e.id>=t&&e.id<=n?Object.assign({},e,{active:!0}):Object.assign({},e,{active:!1}):e.id<=t&&e.id>=n?Object.assign({},e,{active:!0}):Object.assign({},e,{active:!1})}return o>=2&&e.id===n?Object.assign({},e,{active:!0}):e.id===n?Object.assign({},e,{active:!e.active}):Object.assign({},e,{active:!1})}function a(e){return e.map(function(e){if(e.active)return e})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.side,t=arguments[1];switch(t.type){case s.INIT_PLE:try{return u({},e,t.preference.side,{files:[].concat(o(t.preference.side.files.map(function(e){return{id:p++,image:e,active:!1}})))})}catch(t){return e}case s.SIDE_VISIBLE:return u({},e,{visible:t.value});case s.SIDE_TOGGLE:return u({},e,{visible:!e.visible});case s.SIDE_ADD_FILES:return u({},e,{files:[].concat(o(e.files),o(t.files.map(function(e){return{id:p++,image:e,active:!1}})))});case s.SIDE_REMOVE_FILES:if(!t.ids.length)return e;var n=[];return e.files.forEach(function(e){t.ids.indexOf(e.id)<0&&n.push(e)}),u({},e,{files:n});case s.SIDE_CHANGE_ACTIVE_FILE:return u({},e,{files:e.files.map(function(n){return i(n,t.start,t.end,t.selectType,a(e.files).length)})});case s.SIDE_UPDATE_PROGRESS:return u({},e,{progressPercent:t.value});default:return e}}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};t.default=l;var c=n(2),s=r(c),f=n(7),d=r(f),p=0},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){e.exports=l}])});
//# sourceMappingURL=PhotoLayoutEditor.js.map